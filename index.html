<!DOCTYPE html>
<html>

<head>
  <title>Navigation entre les éléments de la page</title>
  <style>
    /* Style de base */
    * {
      font-family: Arial, Helvetica, sans-serif;
    }

    /*dimension des images dans les div - colonne*/
    .row img {
      width: 50px;
      /* Spécifie la largeur souhaitée */
      height: 50px;
      /* Spécifie la hauteur souhaitée */
    }

    /* Mise en page des lignes et colonnes */
    .row {
      display: flex;
      justify-content: flex-start;
      position: relative;
      /* Alignement à gauche par défaut */
    }

    .row.highlighted .column {
      transform: translateX(-50px);
      /* Décale la ligne vers la gauche */
    }

    .row.highlighted .column:last-child {
      transform: translateX(0);
      /* Réinitialise le décalage du dernier élément */
    }

    .column {
      display: flex;
      flex-direction: row;
      transition: transform 0.3s ease;
      /* Ajoute une transition fluide lors du décalage */
    }

    .child:active {
      background-color: rgb(170, 25, 30);
    }

    .highlighted {
      background-color: rgb(170, 25, 30);
    }

    #main {
      overflow: hidden;
      position: relative;
    }

    img {
      object-fit: cover;
    }

    .vignette {
      position: relative;
    }

    .vignette img {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
    }

    .vignette p {
      margin: 0;
      position: absolute;
      line-height: 30px;
      width: 100%;
      bottom: 0;
      text-align: center;
      background-color: rgba(0, 0, 0, 0.3);
      color: white;
    }

  /* gestion header */
    header {
      display: flex;
      flex-direction: row;
      justify-content: space-between;
      border: 2px solid black;
      background-color: rgba(0, 0, 0, 0.5);
      color: white;
      padding: 10px 15px 10px 15px;
      height: 15vh;
    }

    header #location {
      display: flex;
      flex-direction: column;
      justify-content: space-around;
    }

    header #location div {
      display: flex;
      align-items: center;
    }

    header #location img {
      height: 30px;
    }

    header #logo {
      height: auto;
      align-self: center;
    }

    header #info {
      display: flex;
      flex-direction: column;
      text-align: end;
      justify-content: space-around;
    }

    header #info #infoHD {
      display: flex;
      flex-direction: row-reverse;
      align-items: center;
    }

    header #info img {
      height: 30px;
      margin-right: 20px;
    }
  </style>
</head>

<body>
  <header id="header">
    <div id="location">
        <span id="city"></span>
        <div>
            <img id="iconWeather" src="" alt="Icone météo">
            <span id="weather">Météo</span>
        </div>
    </div>
    <img id="logo" src="" alt="Logo">
    <div id="info">
        <span id="client">Client</span>
        <span id="date">Date</span>
        <div id="infoHD">
            <span id="time">Heure</span>
            <img src="https://cdn-icons-png.flaticon.com/512/330/330490.png" alt="langue FR">
        </div>
    </div>
</header>


  <section id="test"></section>
  <div>
    <section id="main"></section>
  </div>

  <script type="module">
    import * as manageLogicModule from "./manageLogic.js";
    import * as logicParserModule from "./logicParser.js";
    import * as requestModule from "./request.js";

    requestModule.getWeather("Toulon")
  .then(([icon, temperature]) => {
    // Use the retrieved icon and temperature here
    console.log("Icon:", icon);
    console.log("Temperature:", temperature);
    const iconweather =document.querySelector("#iconWeather");
    const temp=document.querySelector("#weather");
    iconweather.setAttribute("src", icon);
    temp.innerHTML=temperature;
    
  })
  .catch((error) => {
    // Handle any errors that occurred during the request
    console.error("Error:", error);
  });


    var mainSection = document.getElementById("main");

    var matrix = logicParserModule.buildLogicMatrix()
    var [i, j] = manageLogicModule.initPosition(matrix);
    var matrixCopy = JSON.parse(JSON.stringify(matrix));
    matrixCopy[i][j] = "A";
    console.table(matrixCopy);

    var count = 0;
    var matrixDom = [];

    for (var i = 0; i < matrix.length; i++) {
      //create row add it to main section and add it to main matrixDom
      var rowDom = document.createElement('div');
      rowDom.style.left = "20px";
      rowDom.classList.add('row');
      var row = [];
      for (var j = 0; j < matrix[i].length; j++) {
        count++;
        var childDom = document.createElement('div');
        childDom.classList.add('child');
        var vignette = new logicParserModule.Vignette(`Vignette ${count}`, `./icon${count}.png`);
        childDom.setAttribute('tabindex', `0`);
        childDom.appendChild(vignette.render());
        rowDom.appendChild(childDom);
        row.push(childDom);
      }
      var divDom = document.createElement('div');
      // div.innerHTML = " ";
      divDom.appendChild(rowDom);
      mainSection.appendChild(divDom);
      matrixDom.push(row);

    }


    function shiftRow(matrixDom, x, y, direction, oldElementPositionX, oldElementPositionY) {
      var row = matrixDom[x][y].parentNode;

      //on recherche la position de l ancienne element active 
      let activeElement = document.activeElement;
      var oldElementPositionX = activeElement.getBoundingClientRect().left;
      var oldElementPositionY = activeElement.getBoundingClientRect().top;
      //on passe au nouveau element active
      matrixDom[x][y].focus();

      if (direction == 'left') {
        row.style.left = parseInt(row.getBoundingClientRect().left) - parseInt(row.getBoundingClientRect().left) - (oldElementPositionX) + "px";
        console.log(row.style.left);

      } else if (direction == 'right') {
        row.style.left = parseInt(row.getBoundingClientRect().left) + parseInt(row.getBoundingClientRect().left) - (oldElementPositionX) + "px";
        console.log(row.style.left);
      }


    }

    document.addEventListener("keydown", function (event) {
      var [i, j] = manageLogicModule.navigationSpatiale(matrix, event, (x, y, direction) => {
        console.log("Changement de position vers la ", x, y, direction);

        // on appella fonction de decalage des ligne 
        shiftRow(matrixDom, x, y, direction);

      });
      var matrixCopy = JSON.parse(JSON.stringify(matrix));
      matrixCopy[i][j] = "A";
      console.table(matrixCopy);
    });

  </script>
</body>

</html>